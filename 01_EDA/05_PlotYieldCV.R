require(raster)
require(rgdal)
require(viridis)
require(ggplot2)

shpDir = "D:/PhD/YieldProject/Data/Yield"

for (shpPath in list.files(shpDir, "YieldCV.*.shp$", full.names=T)[1]){
  shp = readOGR(shpPath)
  shp@data$id <- rownames(shp@data)
  fort <- fortify(shp, region = "id")
  newdf <- merge(fort, shp@data, by = "id")
  myplot <- ggplot() +
    geom_polygon(data = newdf, aes(fill = CV, x = long, 
                                   y = lat, 
                                   group = group)) + 
    ggtitle("Township Yield CV, 2010 to 2021") + 
    theme(plot.title = element_text(hjust =0.5)) +
    coord_map() +
    scale_fill_viridis(option = "magma", direction = -1)
}
