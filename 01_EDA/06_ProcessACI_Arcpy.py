import os, glob, arcpy

# User parameters
aciDir = r"D:\PhD\AAFC_Data\ACI\Raw"
mergeDir = r"D:\PhD\AAFC_Data\ACI\Merged"
maskDir = r"D:\PhD\AAFC_Data\ACI\Masked"

template = r"D:\PhD\AAFC_Data\ACI\ndvi_template.tif"
arcpy.env.cellSize = template
arcpy.env.snapRaster = template
arcpy.env.extent = template
arcpy.env.mask = template

# Loop through and get files for each year
for year in range(2011, 2022):
    flist = glob.glob(aciDir + "//aci_{}*.tif".format(year))
    arcpy.MosaicToNewRaster_management(input_rasters=flist, output_location=mergeDir, raster_dataset_name_with_extension="aci_{}_prairies.tif".format(year),
                                       pixel_type="8_BIT_UNSIGNED", cellsize="", number_of_bands="1", mosaic_method="MAXIMUM", mosaic_colormap_mode="FIRST",
                                       coordinate_system_for_the_raster="PROJCS['Lambert_Conformal_Conic_2SP',GEOGCS['GCS_Unknown_datum_based_upon_the_GRS_1980_ellipsoid',DATUM['D_Unknown',SPHEROID['Unknown',6378137.0,298.257222101]],PRIMEM['Greenwich',0.0],UNIT['Degree',0.0174532925199433]],PROJECTION['Lambert_Conformal_Conic'],PARAMETER['false_easting',0.0],PARAMETER['false_northing',0.0],PARAMETER['central_meridian',-95.0],PARAMETER['standard_parallel_1',49.0],PARAMETER['standard_parallel_2',77.0],PARAMETER['latitude_of_origin',0.0],UNIT['Meter',1.0]]")
    flist = glob.glob(mergeDir + "//aci_{}*.tif".format(year))
    for f in flist:
        outfile = os.path.join(maskDir, os.path.basename(f))
        arcpy.gp.ExtractByMask_sa(f, template, outfile)
